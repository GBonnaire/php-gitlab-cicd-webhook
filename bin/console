#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

define('ROOT_FOLDER', dirname(__DIR__) . "/");
define('MODE_CLI', true);

use Gbonnaire\PhpGitlabCicdWebhook\Service\ConfigService;
use Gbonnaire\PhpGitlabCicdWebhook\Service\DeployerService;
use Gbonnaire\PhpGitlabCicdWebhook\Service\HttpService;
use Gbonnaire\PhpGitlabCicdWebhook\Service\LoggerService;
use Gbonnaire\PhpGitlabCicdWebhook\Service\SecurityService;
use Gbonnaire\PhpGitlabCicdWebhook\Command\InstallCommand;
use Gbonnaire\PhpGitlabCicdWebhook\Command\ListCommand;
use Gbonnaire\PhpGitlabCicdWebhook\Command\LogsCommand;
use Gbonnaire\PhpGitlabCicdWebhook\Command\RemoveCommand;
use Gbonnaire\PhpGitlabCicdWebhook\Command\TestCommand;
use Symfony\Component\Console\Application;

$logger = new LoggerService();
$config = new ConfigService();
$security = new SecurityService();
$deployer = new DeployerService($logger);
$http = new HttpService();

$application = new Application('GitLab Webhook CI/CD Manager', '1.0.0');

$application->add(new InstallCommand($config, $security, $deployer, $logger, $http));
$application->add(new ListCommand($config));
$application->add(new RemoveCommand($config));
$application->add(new TestCommand($config, $deployer));
$application->add(new LogsCommand($logger));

$application->run();